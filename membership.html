<!DOCTYPE html>

<!--
 // WEBSITE: https://themefisher.com
 // TWITTER: https://twitter.com/themefisher
 // FACEBOOK: https://www.facebook.com/themefisher
 // GITHUB: https://github.com/themefisher/
-->

<html lang="en">
<head>

  <!-- Basic Page Needs
	================================================== -->
  <meta charset="utf-8">
  <title>PAPSI - Membership</title>

  <!-- Mobile Specific Metas
	================================================== -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="Construction Html5 Template">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
  <meta name="author" content="Themefisher">
  <meta name="generator" content="Themefisher Educenter HTML Template v1.0">

  <!-- ** Plugins Needed for the Project ** -->
  <!-- Bootstrap -->
  <link rel="stylesheet" href="plugins/bootstrap/bootstrap.min.css">
  <!-- slick slider -->
  <link rel="stylesheet" href="plugins/slick/slick.css">
  <!-- themefy-icon -->
  <link rel="stylesheet" href="plugins/themify-icons/themify-icons.css">
  <!-- animation css -->
  <link rel="stylesheet" href="plugins/animate/animate.css">
  <!-- aos -->
  <link rel="stylesheet" href="plugins/aos/aos.css">
  <!-- venobox popup -->
  <link rel="stylesheet" href="plugins/venobox/venobox.css">

  <!-- Main Stylesheet -->
  <link href="css/style.css" rel="stylesheet">

  <!--Favicon-->
  <link rel="shortcut icon" href="images/favicon.png" type="image/x-icon">
  <link rel="icon" href="images/favicon.png" type="image/x-icon">

  <!-- Subtle placeholder styling for Suffix field -->
  <style>
    /* Make the suffix placeholder (e.g., "Jr., III") lighter/subtle */
    #memberInfoModal #mi_suffix::placeholder { color: #adb5bd; opacity: 1; }
    /* Edge/IE fallbacks */
    #memberInfoModal #mi_suffix:-ms-input-placeholder { color: #adb5bd; }
    #memberInfoModal #mi_suffix::-ms-input-placeholder { color: #adb5bd; }
  </style>

</head>

<body>
  <!-- preloader start -->
  <div class="preloader">
    <img src="images/preloader.gif" alt="preloader">
  </div>
  <!-- preloader end -->

  
    <!-- header -->
<header class="fixed-top header">
<!-- top header -->
<div class="top-header py-2 bg-white">
  <div class="container">
    <div class="row no-gutters align-items-center"> <!-- Add align-items-center class -->
      <div class="col-lg-7 text-center text-lg-left">
        <strong>PHILIPPINE ASSOCIATION OF PHYSICS AND SCIENCE INSTRUCTORS</strong>
      </div>
  
      <div class="col-lg-5 text-center text-lg-right">
        <ul class="list-inline">
 <!--         <li class="list-inline-item ti-search"></li>
          <a class="text-uppercase text-color p-sm-2 py-2 px-0 d-inline-block" href="searchmember.html">Search by Member</a>
          <li class="list-inline-item ti-search"></li>
         <a class="text-uppercase text-color p-sm-2 py-2 px-0 d-inline-block" href="searchtraining.html">Search by Training</a> -->
        </ul>
      </div>
    </div>
  </div>
</div>


  <!-- navbar -->
  <div class="navigation w-100">
    <div class="container">
  <nav class="navbar navbar-expand-lg navbar-dark p-0 papsi-navbar">
  <a class="navbar-brand" href="index.html"><img src="https://papsitrainingcenter.weebly.com/uploads/2/5/9/7/25977880/papsilogo_1.png" alt="PAPSI Logo"></a>
        <button class="navbar-toggler rounded-0" type="button" data-toggle="collapse" data-target="#navigation"
          aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navigation">
          <ul class="navbar-nav ml-auto text-center">
            <li class="nav-item">
              <a class="nav-link" href="index.html">Home</a>
            </li>
            <li class="nav-item @@about">
              <a class="nav-link" href="center.html">Training Center</a>
            </li>
            <li class="nav-item @@about">
              <a class="nav-link" href="portal.html">Member Portal</a>
            </li>
            <li class="nav-item active">
              <a class="nav-link" href="membership.html">Membership</a>
            </li>
            <li class="nav-item @@courses">
              <a class="nav-link" href="about.html">About</a>
            </li>
            <li class="nav-item @@events">
              <a class="nav-link" href="certificate.html">Certificate</a>
            </li>
            <li class="nav-item @@events">
              <a class="nav-link" href="verification.html">Verification</a>
            </li>
             <li class="nav-item @@contact">
              <a class="nav-link" href="contact.html">Contact</a>
            </li>
          </ul>
        </div>
      </nav>
    </div>
  </div>
  </header>
  <!-- /header -->
<!-- Modal -->
<div class="modal fade" id="signupModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content rounded-0 border-0 p-4">
            <div class="modal-header border-0">
                <h3>Register</h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="login">
                    <form action="#" class="row">
                        <div class="col-12">
                            <input type="text" class="form-control mb-3" id="signupPhone" name="signupPhone" placeholder="Phone">
                        </div>
                        <div class="col-12">
                            <input type="text" class="form-control mb-3" id="signupName" name="signupName" placeholder="Name">
                        </div>
                        <div class="col-12">
                            <input type="email" class="form-control mb-3" id="signupEmail" name="signupEmail" placeholder="Email">
                        </div>
                        <div class="col-12">
                            <input type="password" class="form-control mb-3" id="signupPassword" name="signupPassword" placeholder="Password">
                        </div>
                        <div class="col-12">
                            <button type="submit" class="btn btn-primary">SIGN UP</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Modal -->
<div class="modal fade" id="loginModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content rounded-0 border-0 p-4">
            <div class="modal-header border-0">
                <h3>Login</h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form action="#" class="row">
                    <div class="col-12">
                        <input type="text" class="form-control mb-3" id="loginPhone" name="loginPhone" placeholder="Phone">
                    </div>
                    <div class="col-12">
                        <input type="text" class="form-control mb-3" id="loginName" name="loginName" placeholder="Name">
                    </div>
                    <div class="col-12">
                        <input type="password" class="form-control mb-3" id="loginPassword" name="loginPassword" placeholder="Password">
                    </div>
                    <div class="col-12">
                        <button type="submit" class="btn btn-primary">LOGIN</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- page title -->
<section class="page-title-section overlay" data-background="images/backgrounds/page-title.jpg">
  <div class="container">
    <div class="row">
      <div class="col-md-8">
        <ul class="list-inline custom-breadcrumb mb-2">
          <li class="list-inline-item"><a class="h2 text-primary font-secondary" href="about.html">PAPSI</a></li>
          <li class="list-inline-item text-white h3 font-secondary nasted">Membership</li>
        </ul>
    
      </div>
    </div>
  </div>
</section>
<!-- /page title -->

<!-- notice details -->
<section class="section">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="d-flex">
          <div class="text-center mr-4">
            <div class="p-4 bg-primary text-white">
                <span class="h2 d-block">✎</span>
            </div>
          </div>
          <!-- notice content -->
          <div>
            <h3 class="mb-4">Membership</h3>
            <p>The annual membership fee is Php 500.00. You will receive the payment procedures on your email after accomplishing the form.</p>
            
            <!-- NEW: Membership Check -->
            <div class="card border-0 shadow-sm mt-4">
              <div class="card-body">
                <h5 class="card-title mb-3">Start the membership process</h5>
                <div class="form-row align-items-end">
                  <div class="form-group col-md-8">
                    <label for="membershipCheckEmail" class="mb-1">Email address</label>
                    <input type="email" class="form-control" id="membershipCheckEmail" placeholder="you@example.com">
                  </div>
                  <div class="form-group col-md-4">
                    <button id="membershipCheckBtn" class="btn btn-success btn-block">Check</button>
                  </div>
                </div>
                <div id="membershipCheckResult" class="mt-2" aria-live="polite"></div>
                <small class="text-muted d-block">Use the same email you used for PAPSI registration or trainings.</small>
              </div>
            </div>
            <!-- /Membership Check -->

            <p> </p>
          </div>
        </div>
        
      </div>
      
    </div>
  </div>
</section>
<!-- /notice details -->


<!-- NEW: Member Information Modal -->
<div class="modal fade" id="memberInfoModal" tabindex="-1" role="dialog" aria-labelledby="memberInfoTitle" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content rounded-0 border-0">
      <div class="modal-header border-0">
        <h5 class="modal-title" id="memberInfoTitle">Member Information</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" title="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body pt-0">
        <form id="memberInfoForm">
          <div class="form-row">
            <div class="form-group col-md-3">
              <label for="mi_title">Title</label>
              <select class="form-control" id="mi_title" name="title" required>
                <option value="">Select title…</option>
                <option>Dr.</option>
                <option>Ms.</option>
                <option>Mr.</option>
                <option>Mrs.</option>
                <option>Ms.</option>
                <option value="__other">Other…</option>
              </select>
              <input type="text" class="form-control mt-2 d-none" id="mi_title_other" placeholder="Please specify" aria-label="Other title">
            </div>
            <div class="form-group col-md-3">
              <label for="mi_firstname">First name</label>
              <input type="text" class="form-control" id="mi_firstname" name="firstname" required>
            </div>
            <div class="form-group col-md-2">
              <label for="mi_middleinitial">Middle initial</label>
              <input type="text" class="form-control" id="mi_middleinitial" name="middleinitial" maxlength="3">
              <small class="form-text text-muted">Leave blank if not applicable.</small>
            </div>
            <div class="form-group col-md-3">
              <label for="mi_lastname">Last name</label>
              <input type="text" class="form-control" id="mi_lastname" name="lastname" required>
            </div>
            <div class="form-group col-md-1">
              <label for="mi_suffix">Suffix</label>
              <input type="text" class="form-control" id="mi_suffix" name="suffix" placeholder="Jr., III">
              <small class="form-text text-muted">Leave blank if not applicable.</small>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group col-md-6">
              <label for="mi_email">Email</label>
              <input type="email" class="form-control" id="mi_email" name="email" required>
            </div>
            <div class="form-group col-md-6">
              <label for="mi_mobilenumber">Mobile number</label>
              <input type="tel" class="form-control" id="mi_mobilenumber" name="mobilenumber" required>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group col-md-6">
              <label for="mi_specialization">Specialization</label>
              <select class="form-control" id="mi_specialization" name="specialization" required>
                <option value="">Select specialization…</option>
                <option>Physics</option>
                <option>Biology</option>
                <option>Chemistry</option>
                <option>Natural Science</option>
                <option>Physical Science</option>
                <option>General Science</option>
                <option>Earth Science</option>
                <option>Mathematics</option>
                <option value="__other">Other…</option>
              </select>
              <input type="text" class="form-control mt-2 d-none" id="mi_specialization_other" placeholder="Please specify">
            </div>
            <div class="form-group col-md-6">
              <label for="mi_school">School</label>
              <input type="text" class="form-control" id="mi_school" name="school" required>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group col-md-6">
              <label for="mi_type">Type</label>
              <select class="form-control" id="mi_type" name="type" required>
                <option value="">Select type…</option>
                <option>Private</option>
                <option>Public</option>
              </select>
            </div>
            <div class="form-group col-md-6">
              <label for="mi_position">Position</label>
              <select class="form-control" id="mi_position" name="position" required>
                <option value="">Select position…</option>
                <option>Student</option>
                <option>Teacher</option>
                <option>Subject Teacher</option>
                <option>Class Adviser</option>
                <option>Homeroom Teacher</option>
                <option>Master Teacher</option>
                <option>Lead Teacher</option>
                <option>Head Teacher</option>
                <option>Assistant Principal/ Vice Principal</option>
                <option>Principal</option>
                <option>Instructor</option>
                <option>Lecturer</option>
                <option>Adjunct Instructor/ Adjunct Faculty</option>
                <option>Teaching Assistant</option>
                <option>Graduate Assistant</option>
                <option>Assistant Professor</option>
                <option>Associate Professor</option>
                <option>Professor</option>
                <option>Visiting Professor/ Visiting Lecturer</option>
                <option>Clinical Instructor/ Clinical Professor</option>
                <option>Research Professor</option>
                <option>Extension Professor</option>
                <option>Distinguished Professor</option>
                <option>Endowed Chair/ Chair Professor</option>
                <option>Professor Emeritus/ Emerita</option>
                <option>Tutor</option>
                <option>Trainer</option>
                <option>Mentor Teacher</option>
                <option>Subject Matter Expert</option>
                <option>Faculty Specialist</option>
                <option value="__other">Other…</option>
              </select>
              <input type="text" class="form-control mt-2 d-none" id="mi_position_other" placeholder="Please specify">
            </div>
          </div>

          <div class="form-group">
            <label for="mi_address">Address</label>
            <textarea class="form-control" id="mi_address" name="address" rows="2" required></textarea>
          </div>

          <div class="form-row">
            <div class="form-group col-md-6">
              <label for="mi_source">How did you hear about PAPSI? (source)</label>
              <select class="form-control" id="mi_source" name="source" required>
                <option value="">Select one…</option>
                <option>From my colleague</option>
                <option>School</option>
                <option>Company</option>
                <option>Website</option>
                <option>Facebook Page</option>
                <option>Text</option>
                <option>Email</option>
                <option>Advertisement</option>
                <option value="__other">Other…</option>
              </select>
              <input type="text" class="form-control mt-2 d-none" id="mi_source_other" placeholder="Please specify">
            </div>
            <div class="form-group col-md-6">
              <label for="mi_why">Why do you want to join?</label>
              <input type="text" class="form-control" id="mi_why" name="why" required>
            </div>
          </div>

          <div id="mi_infoNote" class="text-muted small mb-2"></div>
          <div id="mi_error" class="alert alert-danger d-none"></div>
        </form>
      </div>
      <div class="modal-footer border-0">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button id="memberInfoSubmitBtn" type="button" class="btn btn-success">Submit</button>
      </div>
    </div>
  </div>
  </div>


  <!-- copyright -->
  <div class="copyright py-4 bg-footer">
    <div class="container">
      <div class="row">
        <div class="col-sm-7 text-sm-left text-center">
          <p class="mb-0">Copyright &copy;
            <script>
              var CurrentYear = new Date().getFullYear()
              document.write(CurrentYear)
            </script> 
            Developed for <a href="https://papsitraining.com/" class="text-muted">PAPSI</a>
          </p>
        </div>
        <div class="col-sm-5 text-sm-right text-center">
          <ul class="list-inline">
            <li class="list-inline-item"><a class="d-inline-block p-2" href="https://facebook.com/papsifbpage"><i class="ti-facebook text-primary"></i></a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</footer>
<!-- /footer -->

<!-- jQuery -->
<script src="plugins/jQuery/jquery.min.js"></script>
<!-- Bootstrap JS -->
<script src="plugins/bootstrap/bootstrap.min.js"></script>
<!-- slick slider -->
<script src="plugins/slick/slick.min.js"></script>
<!-- aos -->
<script src="plugins/aos/aos.js"></script>
<!-- venobox popup -->
<script src="plugins/venobox/venobox.min.js"></script>
<!-- filter -->
<script src="plugins/filterizr/jquery.filterizr.min.js"></script>
<!-- google map -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCcABaamniA6OL5YvYSpB3pFMNrXwXnLwU"></script>
<script src="plugins/google-map/gmap.js"></script>
<!-- ph map-->


<!-- Main Script -->
<script src="js/script.js"></script>

<!-- NEW: Membership check logic (Web POST) -->
<script>
(function(){
  var BTN = document.getElementById('membershipCheckBtn');
  var EMAIL = document.getElementById('membershipCheckEmail');
  var OUT = document.getElementById('membershipCheckResult');

  var MODAL = $('#memberInfoModal');
  var FORM = document.getElementById('memberInfoForm');
  var fields = {
    title: document.getElementById('mi_title'),
    firstname: document.getElementById('mi_firstname'),
    middleinitial: document.getElementById('mi_middleinitial'),
    lastname: document.getElementById('mi_lastname'),
    suffix: document.getElementById('mi_suffix'),
    email: document.getElementById('mi_email'),
    mobilenumber: document.getElementById('mi_mobilenumber'),
    specialization: document.getElementById('mi_specialization'),
    school: document.getElementById('mi_school'),
    type: document.getElementById('mi_type'),
    address: document.getElementById('mi_address'),
    position: document.getElementById('mi_position'),
    source: document.getElementById('mi_source'),
    why: document.getElementById('mi_why')
  };
  var infoNote = document.getElementById('mi_infoNote');
  var errBox = document.getElementById('mi_error');

  var BASE = 'https://script.google.com/macros/s/AKfycbydRAAaO83lKJpCpu7a48YlncAX9R5N1KvRx5LqMofd6Dd-O1S_Mnp9tGysVGFV7q6dZQ/exec';

  function isValidEmail(v){
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(v||'').trim());
  }
  function setPending(pending){
    if (!BTN) return;
    BTN.disabled = !!pending;
    BTN.textContent = pending ? 'Checking…' : 'Check';
  }
  function showMsg(html, type){
    if (!OUT) return;
    var cls = type === 'error' ? 'alert alert-danger' :
              type === 'warn'  ? 'alert alert-warning' :
              type === 'ok'    ? 'alert alert-success' :
                                 'alert alert-secondary';
    OUT.className = cls;
    OUT.innerHTML = html;
  }
  function fillField(input, value){
    if (!input) return;
    if (value === undefined || value === null) return;
    input.value = String(value);
  }
  function openMemberInfoModal(data, email){
    // Reset errors
    if (errBox) { errBox.classList.add('d-none'); errBox.textContent = ''; }
    // Clear fields
    Object.keys(fields).forEach(function(k){ if (fields[k]) fields[k].value = ''; });
    // Prefill email
    fillField(fields.email, email || '');
    // Ensure all "Other" inputs are hidden/reset before mapping
    ;(function(){
      ['mi_title_other','mi_specialization_other','mi_position_other','mi_source_other'].forEach(function(id){
        var el = document.getElementById(id);
        if (el) { el.classList.add('d-none'); el.value = ''; }
      });
    })();
    if (data && typeof data === 'object') {
      // Map common keys (case-insensitive)
      var map = function(o, keys){
        for (var i=0;i<keys.length;i++){
          var k = keys[i];
          if (o[k] !== undefined && o[k] !== null && o[k] !== '') return o[k];
        }
        return '';
      };
      var o = data;
      // Title handling: if value not in list, set select to Other and put the rest in the custom field
      var titleVal = map(o, ['title','Title']);
      var titleSel = document.getElementById('mi_title');
      var titleOther = document.getElementById('mi_title_other');
      if (titleSel) {
        var known = ['Dr.','Ms.','Mr.','Mrs.','Ms.'];
        if (titleVal && known.indexOf(titleVal) >= 0) {
          titleSel.value = titleVal;
          if (titleOther) { titleOther.classList.add('d-none'); titleOther.value = ''; }
        } else if (titleVal) {
          titleSel.value = '__other';
          if (titleOther) { titleOther.classList.remove('d-none'); titleOther.value = titleVal; }
        } else {
          titleSel.value = '';
          if (titleOther) { titleOther.classList.add('d-none'); titleOther.value = ''; }
        }
      }
      fillField(fields.firstname,      map(o, ['firstname','firstName','FirstName','First','first']));
      fillField(fields.middleinitial,  map(o, ['middleinitial','middle','Middle','MiddleInitial']));
      fillField(fields.lastname,       map(o, ['lastname','lastName','LastName','Last','last']));
      fillField(fields.suffix,         map(o, ['suffix','Suffix']));
      fillField(fields.email,          map(o, ['email','Email']) || email);
      fillField(fields.mobilenumber,   map(o, ['mobilenumber','mobile','Mobile','contact','Contact']));
      // Specialization: select or other
      (function(){
        var spec = map(o, ['specialization','Specialization']);
        var sel = document.getElementById('mi_specialization');
        var other = document.getElementById('mi_specialization_other');
        var known = ['Physics','Biology','Chemistry','Natural Science','Physical Science','General Science','Earth Science','Mathematics'];
        if (sel) {
          if (spec && known.indexOf(spec) >= 0) {
            sel.value = spec;
            if (other) { other.classList.add('d-none'); other.value = ''; }
          } else if (spec) {
            sel.value = '__other';
            if (other) { other.classList.remove('d-none'); other.value = spec; }
          } else {
            sel.value = '';
            if (other) { other.classList.add('d-none'); other.value = ''; }
          }
        }
      })();
      fillField(fields.school,         map(o, ['school','School','affiliation','Affiliation']));
      fillField(fields.type,           map(o, ['type','Type']));
      fillField(fields.address,        map(o, ['address','Address']));
      // Position (maps old occupation/Occupation/position keys)
      (function(){
        var pos = map(o, ['position','Position','occupation','Occupation']);
        var sel = document.getElementById('mi_position');
        var other = document.getElementById('mi_position_other');
        var known = [
          'Lecturer','Adjunct Instructor/ Adjunct Faculty','Teaching Assistant','Graduate Assistant','Assistant Professor','Associate Professor','Professor','Visiting Professor/ Visiting Lecturer','Clinical Instructor/ Clinical Professor','Research Professor','Extension Professor','Distinguished Professor','Endowed Chair/ Chair Professor','Professor Emeritus/ Emerita','Tutor','Trainer','Mentor Teacher','Subject Matter Expert','Faculty Specialist'
        ];
        if (sel) {
          if (pos && known.indexOf(pos) >= 0) {
            sel.value = pos;
            if (other) { other.classList.add('d-none'); other.value = ''; }
          } else if (pos) {
            sel.value = '__other';
            if (other) { other.classList.remove('d-none'); other.value = pos; }
          } else {
            sel.value = '';
            if (other) { other.classList.add('d-none'); other.value = ''; }
          }
        }
      })();
      // Source (select or other)
      (function(){
        var src = map(o, ['source','Source']);
        var sel = document.getElementById('mi_source');
        var other = document.getElementById('mi_source_other');
        var known = ['From my colleague','School','Company','Website','Facebook Page','Text','Email','Advertisement'];
        if (sel) {
          if (src && known.indexOf(src) >= 0) {
            sel.value = src;
            if (other) { other.classList.add('d-none'); other.value = ''; }
          } else if (src) {
            sel.value = '__other';
            if (other) { other.classList.remove('d-none'); other.value = src; }
          } else {
            sel.value = '';
            if (other) { other.classList.add('d-none'); other.value = ''; }
          }
        }
      })();
      fillField(fields.why,            map(o, ['why','Why','reason','Reason']));
      if (infoNote) infoNote.textContent = 'Loaded information found on file. Please review and update if needed.';
    } else {
      if (infoNote) infoNote.textContent = 'New member. Please complete the fields below.';
    }
    MODAL && MODAL.modal('show');
  }

  async function doCheck(){
    var email = (EMAIL && EMAIL.value || '').trim();
    if (OUT) { OUT.className = ''; OUT.textContent = ''; }
    if (!isValidEmail(email)){
      showMsg('Please enter a valid email address.', 'error');
      EMAIL && EMAIL.focus();
      return;
    }
    setPending(true);
    try{
      // Web POST to membershipcheck with email in query string
      var url = BASE + '?SH=Sheet1&func=membershipcheck&email=' + encodeURIComponent(email);
      var res = await fetch(url, { method: 'POST' });
      var text = await res.text();
      var trimmed = (text || '').trim();
      if (/^new$/i.test(trimmed)){
        openMemberInfoModal(null, email);
        showMsg('New member detected. Please complete your information.', 'ok');
        return;
      }
      // Try JSON
      var data = null;
      try { data = JSON.parse(text); } catch {}
      if (data && typeof data === 'object'){
        openMemberInfoModal(data, email);
        showMsg('We found your information. Please review and update if needed.', 'ok');
        return;
      }
      if (trimmed){
        showMsg(trimmed, 'warn');
      } else {
        showMsg('Unexpected response. Please try again later.', 'error');
      }
    } catch (e){
      showMsg((e && e.message) || 'Unable to check membership right now.', 'error');
    } finally {
      setPending(false);
    }
  }

  BTN && BTN.addEventListener('click', doCheck);
  EMAIL && EMAIL.addEventListener('keydown', function(e){ if (e.key === 'Enter') { e.preventDefault(); doCheck(); } });

  // Submit: validate all required fields (except middle initial & suffix), POST to membershipadd
  var submitBtn = document.getElementById('memberInfoSubmitBtn');
  function setSubmitPending(p){ if (submitBtn){ submitBtn.disabled = !!p; submitBtn.textContent = p ? 'Submitting…' : 'Submit'; } }
  submitBtn && submitBtn.addEventListener('click', async function(){
    if (errBox) { errBox.classList.add('d-none'); errBox.textContent = ''; }
    // Gather values
    var titleSel = document.getElementById('mi_title');
    var titleOther = document.getElementById('mi_title_other');
    var firstname = (document.getElementById('mi_firstname')?.value || '').trim();
    var middleinitial = (document.getElementById('mi_middleinitial')?.value || '').trim(); // optional
    var lastname = (document.getElementById('mi_lastname')?.value || '').trim();
    var suffix = (document.getElementById('mi_suffix')?.value || '').trim(); // optional
    var emailVal = (document.getElementById('mi_email')?.value || '').trim();
    var mobile = (document.getElementById('mi_mobilenumber')?.value || '').trim();
    var specSel = document.getElementById('mi_specialization');
    var specOther = document.getElementById('mi_specialization_other');
    var school = (document.getElementById('mi_school')?.value || '').trim();
    var typeVal = (document.getElementById('mi_type')?.value || '').trim();
    var address = (document.getElementById('mi_address')?.value || '').trim();
    var posSel = document.getElementById('mi_position');
    var posOther = document.getElementById('mi_position_other');
    var srcSel = document.getElementById('mi_source');
    var srcOther = document.getElementById('mi_source_other');
    var why = (document.getElementById('mi_why')?.value || '').trim();

    var titleVal = (titleSel?.value === '__other') ? (titleOther?.value || '').trim() : (titleSel?.value || '').trim();
    var specVal = (specSel?.value === '__other') ? (specOther?.value || '').trim() : (specSel?.value || '').trim();
    var positionVal = (posSel?.value === '__other') ? (posOther?.value || '').trim() : (posSel?.value || '').trim();
    var sourceVal = (srcSel?.value === '__other') ? (srcOther?.value || '').trim() : (srcSel?.value || '').trim();

    // Validate required fields
    var errs = [];
    if (!titleVal) errs.push('Title');
    if (!firstname) errs.push('First name');
    if (!lastname) errs.push('Last name');
    if (!emailVal || !isValidEmail(emailVal)) errs.push('Valid email');
    if (!mobile) errs.push('Mobile number');
    if (!specVal) errs.push('Specialization');
    if (!school) errs.push('School');
    if (!typeVal) errs.push('Type');
    if (!address) errs.push('Address');
    if (!positionVal) errs.push('Position');
    if (!sourceVal) errs.push('Source');
    if (!why) errs.push('Reason (Why)');
    if (errs.length){
      if (errBox){ errBox.textContent = 'Please complete: ' + errs.join(', ') + '.'; errBox.classList.remove('d-none'); }
      return;
    }

    // Normalize name parts to UPPERCASE before submission
    firstname = firstname.toUpperCase();
    middleinitial = middleinitial.toUpperCase();
    lastname = lastname.toUpperCase();
    suffix = suffix.toUpperCase();

    setSubmitPending(true);
    try {
      var addUrl = BASE + '?SH=Sheet1&func=membershipadd'
        + '&title=' + encodeURIComponent(titleVal)
        + '&firstname=' + encodeURIComponent(firstname)
        + '&middleinitial=' + encodeURIComponent(middleinitial)
        + '&lastname=' + encodeURIComponent(lastname)
        + '&suffix=' + encodeURIComponent(suffix)
        + '&email=' + encodeURIComponent(emailVal)
        + '&mobilenumber=' + encodeURIComponent(mobile)
        + '&specialization=' + encodeURIComponent(specVal)
        + '&school=' + encodeURIComponent(school)
        + '&type=' + encodeURIComponent(typeVal)
        + '&address=' + encodeURIComponent(address)
        + '&occupation=' + encodeURIComponent(positionVal)
        + '&source=' + encodeURIComponent(sourceVal)
        + '&why=' + encodeURIComponent(why);
      var res = await fetch(addUrl, { method: 'POST', headers: { 'Content-Type': 'text/plain; charset=UTF-8' } });
      var text = await res.text();
      var norm = (text || '').trim();
      if (/^successful$/i.test(norm) || /successful/i.test(norm)) {
        // Close modal and show success notice near the check box
        MODAL && MODAL.modal('hide');
        var msg = 'Membership request submitted successfully. Please check your email: <strong>' +
                  (emailVal.replace(/[&<>"]/g, function(c){return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c];})) +
                  '</strong> for the confirmation email (subject: <em>PAPSI Membership Request</em>) from: <strong>papsi.seminar@gmail.com</strong>.';
        showMsg(msg, 'ok');
      } else {
        if (errBox){ errBox.textContent = norm || 'Unsuccessful. There was an error.'; errBox.classList.remove('d-none'); }
      }
    } catch (e){
      if (errBox){ errBox.textContent = (e && e.message) || 'Unsuccessful. There was an error.'; errBox.classList.remove('d-none'); }
    } finally {
      setSubmitPending(false);
    }
  });

  // Toggle Other title input based on selection
  (function(){
    var titleSel = document.getElementById('mi_title');
    var titleOther = document.getElementById('mi_title_other');
    if (!titleSel || !titleOther) return;
    titleSel.addEventListener('change', function(){
      if (this.value === '__other') {
        titleOther.classList.remove('d-none');
        titleOther.focus();
      } else {
        titleOther.classList.add('d-none');
        titleOther.value = '';
      }
    });
  })();

  // Toggle Other specialization input
  (function(){
    var sel = document.getElementById('mi_specialization');
    var other = document.getElementById('mi_specialization_other');
    if (!sel || !other) return;
    sel.addEventListener('change', function(){
      if (this.value === '__other') {
        other.classList.remove('d-none');
        other.focus();
      } else {
        other.classList.add('d-none');
        other.value = '';
      }
    });
  })();

  // Toggle Other position input
  (function(){
    var sel = document.getElementById('mi_position');
    var other = document.getElementById('mi_position_other');
    if (!sel || !other) return;
    sel.addEventListener('change', function(){
      if (this.value === '__other') {
        other.classList.remove('d-none');
        other.focus();
      } else {
        other.classList.add('d-none');
        other.value = '';
      }
    });
  })();

  // Toggle Other source input
  (function(){
    var sel = document.getElementById('mi_source');
    var other = document.getElementById('mi_source_other');
    if (!sel || !other) return;
    sel.addEventListener('change', function(){
      if (this.value === '__other') {
        other.classList.remove('d-none');
        other.focus();
      } else {
        other.classList.add('d-none');
        other.value = '';
      }
    });
  })();
})();
</script>

</body>
</html>