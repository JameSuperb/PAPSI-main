<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PAPSI Membership Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
    // --- DYNAMIC ANNOUNCEMENTS ---
    async function loadAnnouncements() {
        const url = "https://script.google.com/macros/s/AKfycbzHpSnUaiBzU-GC0YhkZVzXHfQkEN6i0N6a_Kp1XfUIr_GsgBTBpsj887zVeNr38ArNVQ/exec?ID=1BkWJctNZtAJtGKw-EXhJnCXm1BhiUz1SZaWL5EyMmjg&SH=announcement&func=announcement";
        const container = document.getElementById('announcementsContainer');
        container.innerHTML = '<div class="text-center text-gray-500 py-8">Loading announcements...</div>';
        try {
            const res = await fetch(url);
            const data = await res.json();
            if (!Array.isArray(data) || data.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-8">No announcements found.</div>';
                return;
            }
            container.innerHTML = data.map(item => {
                const postedAgo = timeAgo(item.dateposted);
                return `
                <div class="bg-gray-50 rounded-lg shadow p-4 flex flex-col items-stretch">
                    <div class="w-full mb-4">
                        <img src="${item.photo}" alt="${item.title}" class="w-full h-auto max-h-[400px] object-contain rounded-md border border-gray-200" style="display:block;margin:0 auto;">
                    </div>
                    <div class="flex-1 flex flex-col">
                        <h4 class="text-lg font-bold text-papsi-dark mb-1">${item.title}</h4>
                        <p class="text-gray-700 mb-2">${item.subtitle}</p>
                        <div class="flex items-center text-xs text-gray-500 mb-2">
                            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                            Posted ${postedAgo}
                        </div>
                        <a href="${item.link}" target="_blank" rel="noopener" class="inline-block bg-papsi-green text-white px-4 py-2 rounded hover:bg-green-700 transition-colors self-start">See more</a>
                    </div>
                </div>
                `;
            }).join('');
        } catch (e) {
            container.innerHTML = '<div class="text-center text-red-500 py-8">Failed to load announcements.</div>';
        }
    }

    // Helper: format posted-ago
    function timeAgo(dateString) {
        const now = new Date();
        const posted = new Date(dateString);
        const diffMs = now - posted;
        const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
        if (diffDays < 1) {
            const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
            if (diffHours < 1) {
                const diffMins = Math.floor(diffMs / (1000 * 60));
                return diffMins <= 1 ? 'just now' : `${diffMins} minutes ago`;
            }
            return diffHours === 1 ? '1 hour ago' : `${diffHours} hours ago`;
        } else if (diffDays < 7) {
            return diffDays === 1 ? '1 day ago' : `${diffDays} days ago`;
        } else if (diffDays < 30) {
            const weeks = Math.floor(diffDays / 7);
            return weeks === 1 ? '1 week ago' : `${weeks} weeks ago`;
        } else if (diffDays < 365) {
            const months = Math.floor(diffDays / 30);
            return months === 1 ? '1 month ago' : `${months} months ago`;
        } else {
            const years = Math.floor(diffDays / 365);
            return years === 1 ? '1 year ago' : `${years} years ago`;
        }
    }
    // --- END DYNAMIC ANNOUNCEMENTS ---
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'papsi-green': '#166938',
                        'papsi-red': '#dc2626',
                        'papsi-gold': '#f59e0b',
                        'papsi-dark': '#1f2937'
                    }
                }
            }
        }
    </script>
    <style>
        .active-tab {
            color: #166938;
            border-bottom: 2px solid #166938;
        }
        .card-hover {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .image-viewer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .image-container {
            position: relative;
            max-width: 90%;
            max-height: 90%;
            overflow: hidden;
            cursor: grab;
        }
        .image-container:active {
            cursor: grabbing;
        }
        .viewer-image {
            max-width: 100%;
            max-height: 100%;
            transition: transform 0.2s ease;
            user-select: none;
        }
        .viewer-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }
        .viewer-btn {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.2s;
        }
        .viewer-btn:hover {
            background: white;
        }
        .zoom-controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
        }
        .training-image {
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .training-image:hover {
            opacity: 0.8;
        }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .modal-content {
            background: white;
            border-radius: 16px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            padding: 2.5rem 2rem;
            box-sizing: border-box;
        }
        .audio-player {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
        }
        .audio-controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .play-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: #166938;
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.2s;
        }
        .play-btn:hover {
            background: #0f5429;
        }
        .audio-progress {
            flex: 1;
            height: 6px;
            background: #e5e7eb;
            border-radius: 3px;
            overflow: hidden;
        }
        .audio-progress-bar {
            height: 100%;
            background: #166938;
            width: 0%;
            transition: width 0.1s;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-3">
                    <img src="https://papsitrainingcenter.weebly.com/uploads/2/5/9/7/25977880/papsilogo_1.png" 
                         alt="PAPSI Logo" 
                         class="h-10 w-auto"
                         onerror="this.src=''; this.alt='PAPSI Logo'; this.style.display='none';">
                    <h1 class="text-xl font-bold text-papsi-dark">Member Portal</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="w-8 h-8 bg-papsi-green rounded-full flex items-center justify-center">
                        <span class="text-white text-sm font-medium">JD</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <!-- Home Page -->
        <div id="home-page" class="page-content">
            <!-- Welcome Section -->
            <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                <div class="flex items-center space-x-4 mb-4">
                    <div class="w-16 h-16 bg-papsi-green rounded-full flex items-center justify-center">
                        <span class="text-white text-xl font-medium">JD</span>
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold text-papsi-dark">Welcome, John Doe</h2>
                        <span class="inline-block bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium mt-2">
                            Active Member
                        </span>
                    </div>
                </div>
            </div>

            <!-- Announcements -->
            <div class="bg-white rounded-lg shadow-sm p-6">
                <h3 class="text-xl font-bold text-papsi-dark mb-4">ðŸ“¢ PAPSI Announcements</h3>
                <div id="announcementsContainer" class="space-y-6">
                    <!-- Announcements will be dynamically populated here -->
                </div>
            </div>
        </div>

        <!-- My Learning Page -->
        <div id="learning-page" class="page-content hidden">
            <!-- Learning Statistics Header -->
            <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                <div class="relative overflow-hidden">
                    <h2 class="text-2xl font-bold text-papsi-dark mb-4">My Learning</h2>
                    
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-papsi-green">6</div>
                            <div class="text-sm text-gray-600">Total</div>
                        </div>
                        <div class="text-center">
                            <div class="text-xl font-semibold text-blue-600">2</div>
                            <div class="text-sm text-gray-600">Physics</div>
                        </div>
                        <div class="text-center">
                            <div class="text-xl font-semibold text-orange-600">2</div>
                            <div class="text-sm text-gray-600">Biology</div>
                        </div>
                        <div class="text-center">
                            <div class="text-xl font-semibold text-purple-600">2</div>
                            <div class="text-sm text-gray-600">Other</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Search and Filter Controls -->
            <div class="bg-white rounded-lg shadow-sm p-4 mb-6">
                <div class="flex flex-col md:flex-row gap-4 items-center">
                    <!-- Search Bar -->
                    <div class="flex-1 relative">
                        <input type="text" id="learningSearchInput" placeholder="Search your courses, speakers, or topics..." 
                               class="w-full pl-10 pr-10 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-papsi-green">
                        <svg class="absolute left-3 top-2.5 w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"/>
                        </svg>
                        <button id="clearLearningSearch" class="absolute right-3 top-2.5 w-5 h-5 text-gray-400 hover:text-gray-600 hidden">
                            <svg fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                            </svg>
                        </button>
                    </div>
                    
                    <!-- Category Filter -->
                    <select id="learningCategoryFilter" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-papsi-green">
                        <option value="all">All Categories</option>
                        <option value="Biology">Biology</option>
                        <option value="Physics">Physics</option>
                        <option value="Chemistry">Chemistry</option>
                        <option value="ICT">ICT</option>
                    </select>
                    
                    <!-- Speaker Filter -->
                    <select id="learningSpeakerFilter" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-papsi-green">
                        <option value="all">All Speakers</option>
                        <option value="Dr. Chona Camille Abeledo">Dr. Chona Camille Abeledo</option>
                        <option value="Dr. James Salveo Olarve">Dr. James Salveo Olarve</option>
                        <option value="Dr. David Penaloza Jr">Dr. David Penaloza Jr</option>
                    </select>
                    
                    <!-- Date Sort -->
                    <select id="learningDateSort" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-papsi-green">
                        <option value="newest">Newest First</option>
                        <option value="oldest">Oldest First</option>
                    </select>
                </div>
                
                <!-- Results Counter -->
                <div class="mt-4 text-sm text-gray-600">
                    <div id="learningResultsCounter" class="font-medium">
                        Showing 6 of 6 courses
                    </div>
                </div>
            </div>
            

            <div id="learningCoursesGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- My learning courses will be dynamically populated here -->
            </div>
        </div>

        <!-- Hub Page -->
        <div id="hub-page" class="page-content hidden">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-papsi-dark">Center for Teacher Excellence</h2>
                <button id="cartButton" class="flex items-center space-x-2 bg-papsi-green text-white px-4 py-2 rounded shadow hover:bg-green-700 transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13l-1.35 2.7A1 1 0 007 17h10a1 1 0 00.95-.68L21 13M7 13V6a1 1 0 011-1h5a1 1 0 011 1v7" />
                    </svg>
                    <span id="cartCount" class="ml-1">0</span>
                </button>
            </div>
            
            <!-- Search and Filter Controls -->
            <div class="bg-white rounded-lg shadow-sm p-4 mb-6">
                <div class="flex flex-col md:flex-row gap-4 items-center">
                    <!-- Search Bar -->
                    <div class="flex-1 relative">
                        <input type="text" id="searchInput" placeholder="Search courses, speakers, or topics..." 
                               class="w-full pl-10 pr-10 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-papsi-green">
                        <svg class="absolute left-3 top-2.5 w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"/>
                        </svg>
                        <button id="clearSearch" class="absolute right-3 top-2.5 w-5 h-5 text-gray-400 hover:text-gray-600 hidden">
                            <svg fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                            </svg>
                        </button>
                    </div>
                    
                    <!-- Category Filter -->
                    <select id="categoryFilter" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-papsi-green">
                        <option value="all">All Categories</option>
                    </select>
                    
                    <!-- Speaker Filter -->
                    <select id="speakerFilter" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-papsi-green">
                        <option value="all">All Speakers</option>
                    </select>
                    
                    <!-- Date Sort -->
                    <select id="dateSort" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-papsi-green">
                        <option value="newest">Newest First</option>
                        <option value="oldest">Oldest First</option>
                    </select>
                </div>
                
                <!-- Results Counter -->
                <div class="mt-4 text-sm text-gray-600">
                    <div id="resultsCounter" class="font-medium">
                        Showing 6 of 6 courses
                    </div>
                </div>
            </div>
            
            <div id="coursesGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Training center courses will be dynamically populated here -->
                </div>
                <!-- Cart Modal -->
                <div id="cartModal" class="modal hidden z-50">
                    <div class="modal-content mx-auto">
                        <div class="flex justify-between items-center border-b pb-2 mb-4">
                            <h3 class="text-xl font-bold text-papsi-dark">My Cart</h3>
                            <button onclick="closeCart()" class="text-gray-400 hover:text-gray-600">
                                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                                </svg>
                            </button>
                        </div>
                        <div id="cartList" class="space-y-3 max-h-80 overflow-y-auto"></div>
                        <div class="mt-4 border-t pt-4">
                            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                                <div class="flex-1">
                                    <label for="voucherInput" class="block text-sm font-medium text-gray-700 mb-1">Voucher Code</label>
                                    <input id="voucherInput" type="text" class="w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-papsi-green" placeholder="Enter voucher code for discount">
                                </div>
                                <div class="flex-1 text-right mt-2 md:mt-0">
                                    <div class="text-sm text-gray-600">Subtotal: <span id="cartSubtotal" class="font-semibold text-papsi-dark">â‚±0.00</span></div>
                                    <div class="text-base font-bold text-papsi-green">Total: <span id="cartTotal">â‚±0.00</span></div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4 flex flex-col md:flex-row gap-2 justify-end">
                            <button id="confirmRegistrationBtn" onclick="confirmRegistration()" class="bg-papsi-green text-white px-4 py-2 rounded hover:bg-green-700 transition-colors flex-1 md:flex-none">Confirm Registration</button>
                            <button onclick="closeCart()" class="bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500 transition-colors flex-1 md:flex-none">Close</button>
                        </div>
                    </div>
                </div>
            </div>
            </div>
        </div>

        <!-- Extras Page -->
        <div id="extras-page" class="page-content hidden">
            <h2 class="text-2xl font-bold text-papsi-dark mb-6">Extras</h2>
            <div id="learningCoursesGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- Calendar Modal -->
        <div id="calendarModal" class="modal hidden z-50">
            <div class="modal-content max-w-3xl mx-auto p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-papsi-dark">Training Calendar</h3>
                    <button onclick="closeCalendarModal()" class="text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                        </svg>
                    </button>
                </div>
                <div class="flex items-center justify-between mb-2">
                    <button onclick="changeCalendarMonth(-1)" class="px-3 py-1 rounded bg-gray-200 hover:bg-gray-300">&#8592; Prev</button>
                    <div id="calendarMonthLabel" class="font-semibold text-lg"></div>
                    <button onclick="changeCalendarMonth(1)" class="px-3 py-1 rounded bg-gray-200 hover:bg-gray-300">Next &#8594;</button>
                </div>
                <div id="calendarGrid" class="overflow-x-auto"></div>
            </div>
        </div>
<script>
// Calendar modal state
let calendarMonth = new Date().getMonth();
let calendarYear = new Date().getFullYear();

function openCalendarModal() {
    renderCalendar();
    document.getElementById('calendarModal').classList.remove('hidden');
    document.body.style.overflow = 'hidden';
}
function closeCalendarModal() {
    document.getElementById('calendarModal').classList.add('hidden');
    document.body.style.overflow = 'auto';
}
function changeCalendarMonth(delta) {
    calendarMonth += delta;
    if (calendarMonth < 0) {
        calendarMonth = 11;
        calendarYear--;
    } else if (calendarMonth > 11) {
        calendarMonth = 0;
        calendarYear++;
    }
    renderCalendar();
}
function renderCalendar() {
    const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
    const daysInMonth = new Date(calendarYear, calendarMonth + 1, 0).getDate();
    const firstDay = new Date(calendarYear, calendarMonth, 1).getDay();
    const calendarGrid = document.getElementById('calendarGrid');
    document.getElementById('calendarMonthLabel').textContent = `${monthNames[calendarMonth]} ${calendarYear}`;

    // Gather events from allCourses (assume course.date or course.startDate)
    // Group events by day
    const events = (allCourses || []).map(c => {
        let dateStr = c.date || c.startDate;
        if (!dateStr) return null;
        let d = new Date(dateStr);
        if (isNaN(d)) return null;
        return { day: d.getDate(), month: d.getMonth(), year: d.getFullYear(), title: c.title };
    }).filter(e => e && e.month === calendarMonth && e.year === calendarYear);

    // Map: day -> array of events
    const eventsByDay = {};
    events.forEach(e => {
        if (!eventsByDay[e.day]) eventsByDay[e.day] = [];
        eventsByDay[e.day].push(e);
    });

    let html = '<table class="w-full text-sm"><thead><tr>';
    ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].forEach(d => html += `<th class="p-1 text-center font-medium">${d}</th>`);
    html += '</tr></thead><tbody><tr>';
    let day = 1;
    let started = false;
    for (let i = 0; i < 6; i++) { // max 6 weeks
        for (let j = 0; j < 7; j++) {
            if (!started && j === firstDay) started = true;
            if (started && day <= daysInMonth) {
                const dayEvents = eventsByDay[day] || [];
                html += `<td class="border h-16 align-top p-1 ${dayEvents.length ? 'bg-green-50' : ''}">`;
                html += `<div class="font-bold">${day}</div>`;
                if (dayEvents.length) {
                    dayEvents.forEach(ev => {
                        html += `<div class="mt-1 text-xs text-papsi-green font-semibold truncate">${ev.title}</div>`;
                    });
                }
                html += '</td>';
                day++;
            } else {
                html += '<td class="border h-16"></td>';
            }
        }
        if (day > daysInMonth) break;
        html += '</tr><tr>';
    }
    html += '</tr></tbody></table>';
    calendarGrid.innerHTML = html;

    // Add scrollable event list for selected day (if needed)
    // Optionally, you can add a click handler to each cell to show a modal with all events for that day
}
</script>
                <div class="bg-white rounded-lg shadow-sm p-6 card-hover">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-green-400 rounded-lg flex items-center justify-center mr-4">
                            <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                        <div>
                            <h3 class="font-semibold text-papsi-dark">Verification</h3>
                            <p class="text-gray-600 text-sm">Verify certificates (enter code, check if valid)</p>
                        </div>
                    </div>
                    <button class="w-full bg-papsi-green text-white py-2 rounded hover:bg-green-700 transition-colors">
                        Verify Certificate
                    </button>
                </div>

                <div class="bg-white rounded-lg shadow-sm p-6 card-hover">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-blue-500 rounded-lg flex items-center justify-center mr-4">
                            <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                        <div>
                            <h3 class="font-semibold text-papsi-dark">PAPSI Calendar</h3>
                            <p class="text-gray-600 text-sm">View events and workshops</p>
                        </div>
                    </div>
                    <button onclick="openCalendarModal()" class="w-full bg-papsi-green text-white py-2 rounded hover:bg-green-700 transition-colors">
                        View Calendar
                    </button>
                </div>

                <div class="bg-white rounded-lg shadow-sm p-6 card-hover">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-orange-500 rounded-lg flex items-center justify-center mr-4">
                            <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                        <div>
                            <h3 class="font-semibold text-papsi-dark">Be a PAPSI Speaker</h3>
                            <p class="text-gray-600 text-sm">Submit profile + topic proposal</p>
                        </div>
                    </div>
                    <button class="w-full bg-papsi-green text-white py-2 rounded hover:bg-green-700 transition-colors">
                        Apply as Speaker
                    </button>
                </div>

                <div class="bg-white rounded-lg shadow-sm p-6 card-hover">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-purple-500 rounded-lg flex items-center justify-center mr-4">
                            <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M5 2a1 1 0 011 1v1h1a1 1 0 010 2H6v1a1 1 0 01-2 0V6H3a1 1 0 010-2h1V3a1 1 0 011-1zm0 10a1 1 0 011 1v1h1a1 1 0 110 2H6v1a1 1 0 11-2 0v-1H3a1 1 0 110-2h1v-1a1 1 0 011-1zM12 2a1 1 0 01.967.744L14.146 7.2 17.5 9.134a1 1 0 010 1.732L14.146 12.8l-1.179 4.456a1 1 0 01-1.934 0L9.854 12.8 6.5 10.866a1 1 0 010-1.732L9.854 7.2l1.179-4.456A1 1 0 0112 2z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                        <div>
                            <h3 class="font-semibold text-papsi-dark">Host an Event</h3>
                            <p class="text-gray-600 text-sm">School or organization requests PAPSI partnership</p>
                        </div>
                    </div>
                    <button class="w-full bg-papsi-green text-white py-2 rounded hover:bg-green-700 transition-colors">
                        Request Partnership
                    </button>
                </div>

                <div class="bg-white rounded-lg shadow-sm p-6 card-hover">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-indigo-500 rounded-lg flex items-center justify-center mr-4">
                            <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"/>
                            </svg>
                        </div>
                        <div>
                            <h3 class="font-semibold text-papsi-dark">Community</h3>
                            <p class="text-gray-600 text-sm">Connect with other members on Facebook group</p>
                        </div>
                    </div>
                    <button class="w-full bg-papsi-green text-white py-2 rounded hover:bg-green-700 transition-colors">
                        Join Facebook Group
                    </button>
                </div>

                <div class="bg-white rounded-lg shadow-sm p-6 card-hover">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center mr-4">
                            <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                            </svg>
                        </div>
                        <div>
                            <h3 class="font-semibold text-papsi-dark">Facebook Page</h3>
                            <p class="text-gray-600 text-sm">Visit the official Facebook page of PAPSI</p>
                        </div>
                    </div>
                    <button class="w-full bg-papsi-green text-white py-2 rounded hover:bg-green-700 transition-colors">
                        Visit Facebook Page
                    </button>
                </div>

                <div class="bg-white rounded-lg shadow-sm p-6 card-hover">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-papsi-red rounded-lg flex items-center justify-center mr-4">
                            <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                        <div>
                            <h3 class="font-semibold text-papsi-dark">Help & Support</h3>
                            <p class="text-gray-600 text-sm">Get assistance and contact support</p>
                        </div>
                    </div>
                    <button class="w-full bg-papsi-green text-white py-2 rounded hover:bg-green-700 transition-colors">
                        Contact Support
                    </button>
                </div>
            </div>
        </div>

        <!-- Profile Page -->
        <div id="profile-page" class="page-content hidden">
            <h2 class="text-2xl font-bold text-papsi-dark mb-6">Profile</h2>
            <div class="bg-white rounded-lg shadow-sm p-6">
                <div class="flex items-center space-x-6 mb-8">
                    <div class="w-24 h-24 bg-papsi-green rounded-full flex items-center justify-center">
                        <span class="text-white text-2xl font-medium">JD</span>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-papsi-dark">John A Doe</h3>
                        <div class="flex items-center space-x-4 mt-1">
                            <span class="inline-block bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">
                                Active
                            </span>
                            <span class="text-gray-600 text-sm">PAPSI ID: 2025001</span>
                        </div>
                        <button class="mt-3 text-papsi-green hover:text-green-700 text-sm font-medium">
                            Change Profile Picture
                        </button>
                    </div>
                </div>

                <form class="space-y-8">
                    <!-- Account Information -->
                    <div class="border-b border-gray-200 pb-6">
                        <h4 class="text-lg font-semibold text-papsi-dark mb-4">Account Information</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-papsi-dark mb-2">Email</label>
                                <input type="email" value="john.doe@email.com" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-papsi-green">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-papsi-dark mb-2">Password</label>
                                <input type="password" value="********" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-papsi-green">
                            </div>
                        </div>
                    </div>

                    <!-- Personal Information -->
                    <div class="border-b border-gray-200 pb-6">
                        <h4 class="text-lg font-semibold text-papsi-dark mb-4">Personal Information</h4>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-papsi-dark mb-2">Title</label>
                                <select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-papsi-green">
                                    <option>Mr.</option>
                                    <option>Ms.</option>
                                    <option>Mrs.</option>
                                    <option>Dr.</option>
                                    <option>Prof.</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-papsi-dark mb-2">First Name</label>
                                <input type="text" value="John" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-papsi-green">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-papsi-dark mb-2">Middle Initial</label>
                                <input type="text" value="A" maxlength="1" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-papsi-green">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-papsi-dark mb-2">Last Name</label>
                                <input type="text" value="Doe" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-papsi-green">
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-papsi-dark mb-2">Suffix</label>
                                <input type="text" value="" placeholder="Jr., Sr., III, etc." class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-papsi-green">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-papsi-dark mb-2">Birth Date</label>
                                <input type="date" value="1985-06-15" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-papsi-green">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-papsi-dark mb-2">Mobile Number</label>
                                <input type="tel" value="+63 912 345 6789" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-papsi-green">
                            </div>
                        </div>
                    </div>

                    <!-- Affiliation -->
                    <div class="border-b border-gray-200 pb-6">
                        <h4 class="text-lg font-semibold text-papsi-dark mb-4">Affiliation</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-papsi-dark mb-2">Name of School/Organization</label>
                                <input type="text" value="University of the Philippines" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-papsi-green">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-papsi-dark mb-2">Type</label>
                                <select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-papsi-green">
                                    <option>Public</option>
                                    <option>Private</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-papsi-dark mb-2">Address of School/Organization</label>
                            <textarea rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-papsi-green" placeholder="Complete address of your school or organization">Diliman, Quezon City, Metro Manila 1101</textarea>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-papsi-dark mb-2">Position</label>
                                <input type="text" value="Associate Professor" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-papsi-green">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-papsi-dark mb-2">Specialization</label>
                                <input type="text" value="Educational Psychology" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-papsi-green">
                            </div>
                        </div>
                    </div>

                    <!-- Academic & Research Information -->
                    <div class="border-b border-gray-200 pb-6">
                        <h4 class="text-lg font-semibold text-papsi-dark mb-4">Academic & Research Information</h4>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-papsi-dark mb-2">About</label>
                                <textarea rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-papsi-green" placeholder="Brief professional background and experience">Experienced educational psychologist with 10+ years in research and practice. Specializes in cognitive development and learning assessment methodologies.</textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-papsi-dark mb-2">Research Interests</label>
                                <textarea rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-papsi-green" placeholder="Areas of research interest">Cognitive development, learning disabilities, educational assessment, psychological testing, child psychology</textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-papsi-dark mb-2">Publications</label>
                                <textarea rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-papsi-green" placeholder="List your publications, research papers, books, etc.">1. "Cognitive Assessment in Filipino Children" - Philippine Journal of Psychology (2022)
2. "Learning Disabilities: A Comprehensive Guide" - PAPSI Publications (2021)
3. "Educational Psychology in the Digital Age" - International Psychology Review (2020)</textarea>
                            </div>
                        </div>
                    </div>

                    <div class="flex space-x-4">
                        <button type="submit" class="bg-papsi-green text-white px-6 py-2 rounded-md hover:bg-green-700 transition-colors">
                            Save Changes
                        </button>
                        <button type="button" class="bg-gray-300 text-gray-700 px-6 py-2 rounded-md hover:bg-gray-400 transition-colors">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t shadow-lg">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-around items-end py-2">
                <button onclick="showPage('home')" id="home-btn" class="flex flex-col items-center py-2 px-3 active-tab">
                    <svg class="w-5 h-5 mb-1" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/>
                    </svg>
                    <span class="text-xs">Home</span>
                </button>
                
                <button onclick="showPage('hub')" id="hub-btn" class="flex flex-col items-center py-2 px-3 text-gray-500">
                    <svg class="w-5 h-5 mb-1" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
                    </svg>
                    <span class="text-xs">Training Center</span>
                </button>
                
                <button onclick="showPage('learning')" id="learning-btn" class="flex flex-col items-center py-2 px-3 text-gray-500">
                    <svg class="w-5 h-5 mb-1" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"/>
                    </svg>
                    <span class="text-xs">My Learning</span>
                </button>
                
                <button onclick="showPage('extras')" id="extras-btn" class="flex flex-col items-center py-2 px-3 text-gray-500">
                    <svg class="w-5 h-5 mb-1" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/>
                    </svg>
                    <span class="text-xs">Extras</span>
                </button>
                
                <button onclick="showPage('profile')" id="profile-btn" class="flex flex-col items-center py-2 px-3 text-gray-500">
                    <svg class="w-5 h-5 mb-1" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                    </svg>
                    <span class="text-xs">Profile</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Add bottom padding to prevent content from being hidden behind nav -->
    <div class="h-20"></div>

    <!-- Image Viewer Modal -->
    <div id="imageViewer" class="image-viewer hidden">
        <div class="viewer-controls">
            <button class="viewer-btn" onclick="closeImageViewer()">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                </svg>
            </button>
        </div>
        <div class="image-container" id="imageContainer">
            <img id="viewerImage" class="viewer-image" src="" alt="Training Image">
        </div>
        <div class="zoom-controls">
            <button class="viewer-btn" onclick="zoomOut()">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"/>
                </svg>
            </button>
            <button class="viewer-btn" onclick="resetZoom()">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"/>
                </svg>
            </button>
            <button class="viewer-btn" onclick="zoomIn()">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"/>
                </svg>
            </button>
        </div>
    </div>

    <!-- About Modal -->
    <div id="aboutModal" class="modal hidden">
        <div class="modal-content">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-papsi-dark" id="aboutTitle">Course Information</h3>
                    <button onclick="closeAbout()" class="text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                        </svg>
                    </button>
                </div>
                <div id="aboutContent" class="space-y-4">
                    <!-- Content will be populated by JavaScript -->
                </div>
                <div class="mt-6 flex space-x-3">
                    <button onclick="closeAbout()" class="flex-1 bg-papsi-green text-white py-2 px-4 rounded hover:bg-green-700 transition-colors">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Audio Modal -->
    <div id="audioModal" class="modal hidden">
        <div class="modal-content">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-papsi-dark" id="audioTitle">Course Preview</h3>
                    <button onclick="closeAudio()" class="text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                        </svg>
                    </button>
                </div>
                <div id="audioContent">
                    <!-- Dynamic audio player will be injected here by playAudio() -->
                    <div class="mt-4">
                        <p class="text-gray-600 text-sm" id="audioDescription">
                            Listen to a preview.
                        </p>
                    </div>
                </div>
                <div class="mt-6 flex space-x-3">
                    <button onclick="closeAudio()" class="flex-1 bg-papsi-green text-white py-2 px-4 rounded hover:bg-green-700 transition-colors">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentZoom = 1;
        let isDragging = false;
        let startX, startY, translateX = 0, translateY = 0;
        let audioPlaying = false;
        let audioProgress = 0;
        let audioInterval;


        // Dynamic data containers for courses
        let allCourses = [];
        let filteredCourses = [];
        let filteredLearningCourses = [];

    // Cart state
    let cartCourses = [];

    // Pagination state for training center
    let currentPage = 1;
    const coursesPerPage = 8;

        // Fetch courses from endpoint and populate allCourses
        async function loadTrainingCourses() {
            const url = "https://script.google.com/macros/s/AKfycbzHpSnUaiBzU-GC0YhkZVzXHfQkEN6i0N6a_Kp1XfUIr_GsgBTBpsj887zVeNr38ArNVQ/exec?ID=1BkWJctNZtAJtGKw-EXhJnCXm1BhiUz1SZaWL5EyMmjg&SH=training&func=training";
            const grid = document.getElementById('coursesGrid');
            const counter = document.getElementById('resultsCounter');
            grid.innerHTML = `<div class="col-span-full text-center py-12 text-gray-500">Loading courses...</div>`;
            try {
                const res = await fetch(url);
                const data = await res.json();
                allCourses = Array.isArray(data) ? data.map((item, idx) => ({
                    id: `course-${idx}`,
                    title: item.title,
                    date: new Date(item.date),
                    hours: item.hours,
                    instructor: item.speaker,
                    image: (typeof item.poster === 'string' && item.poster.startsWith('http')) ? item.poster : '',
                    category: item.category,
                    price: item.promo_fee ? `â‚±${item.promo_fee}` : '',
                    originalPrice: item.regular_fee ? `â‚±${item.regular_fee}` : '',
                    description: item.about,
                    audio: item.audio,
                    duration: item.hours + ' hours'
                })) : [];

                // Populate category and speaker filters dynamically
                populateCourseFilters();
                filteredCourses = [...allCourses];
                renderCourses();
                updateCounters();

        // Populate category and speaker filter dropdowns dynamically
        function populateCourseFilters() {
            const categoryFilter = document.getElementById('categoryFilter');
            const speakerFilter = document.getElementById('speakerFilter');
            if (!categoryFilter || !speakerFilter) return;

            // Get unique categories and speakers from allCourses
            const categories = Array.from(new Set(allCourses.map(c => c.category).filter(Boolean))).sort();
            const speakers = Array.from(new Set(allCourses.map(c => c.instructor).filter(Boolean))).sort();

            // Save current selections
            const selectedCategory = categoryFilter.value;
            const selectedSpeaker = speakerFilter.value;

            // Populate categories
            categoryFilter.innerHTML = '<option value="all">All Categories</option>' +
                categories.map(cat => `<option value="${cat}">${cat}</option>`).join('');
            // Restore selection if possible
            if (categories.includes(selectedCategory)) categoryFilter.value = selectedCategory;

            // Populate speakers
            speakerFilter.innerHTML = '<option value="all">All Speakers</option>' +
                speakers.map(spk => `<option value="${spk}">${spk}</option>`).join('');
            // Restore selection if possible
            if (speakers.includes(selectedSpeaker)) speakerFilter.value = selectedSpeaker;
        }
            } catch (e) {
                grid.innerHTML = `<div class="col-span-full text-center py-12 text-red-500">Failed to load courses.</div>`;
                counter.textContent = "Showing 0 of 0 courses";
                allCourses = [];
                filteredCourses = [];
            }
        }

        // Search and filter functionality for Training Center
        function filterCourses() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            const speakerFilter = document.getElementById('speakerFilter').value;
            const dateSort = document.getElementById('dateSort').value;

            // Filter courses
            filteredCourses = allCourses.filter(course => {
                const matchesSearch = !searchTerm || 
                    course.title.toLowerCase().includes(searchTerm) ||
                    course.instructor.toLowerCase().includes(searchTerm) ||
                    course.description.toLowerCase().includes(searchTerm);
                
                const matchesCategory = categoryFilter === 'all' || course.category === categoryFilter;
                const matchesSpeaker = speakerFilter === 'all' || course.instructor === speakerFilter;

                return matchesSearch && matchesCategory && matchesSpeaker;
            });

            // Sort courses
            filteredCourses.sort((a, b) => {
                if (dateSort === 'newest') {
                    return b.date - a.date;
                } else {
                    return a.date - b.date;
                }
            });

            renderCourses();
            updateCounters();
        }

        function renderCourses() {
            const grid = document.getElementById('coursesGrid');

            // Helper to check if course is in cart
            function isInCart(courseId) {
                return cartCourses.includes(courseId);
            }

            if (filteredCourses.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6-4h6m2 5.291A7.962 7.962 0 0112 15c-2.34 0-4.29-1.009-5.824-2.562M15 6.306a7.962 7.962 0 00-6 0m6 0V5a2 2 0 00-2-2H9a2 2 0 00-2 2v1.306m8 0V7a2 2 0 012 2v6.414l.293.293a1 1 0 001.414-1.414L16 12.586V11a2 2 0 00-2-2H8a2 2 0 00-2 2v1.586l-2.707 2.707a1 1 0 001.414 1.414L7 14.414V13a2 2 0 012-2h6a2 2 0 012 2z"/>
                        </svg>
                        <h3 class="mt-2 text-sm font-medium text-gray-900">No courses found</h3>
                        <p class="mt-1 text-sm text-gray-500">Try adjusting your search or filter criteria.</p>
                    </div>
                `;
                // No pagination if no courses
                return;
            }

            // Pagination logic
            const totalCourses = filteredCourses.length;
            const totalPages = Math.ceil(totalCourses / coursesPerPage);
            if (currentPage > totalPages) currentPage = totalPages;
            if (currentPage < 1) currentPage = 1;
            const startIdx = (currentPage - 1) * coursesPerPage;
            const endIdx = startIdx + coursesPerPage;
            const coursesToShow = filteredCourses.slice(startIdx, endIdx);

            // Render courses
            grid.innerHTML = coursesToShow.map(course => {
                // Use function-scoped variables to avoid redeclaration errors
                var catColors = {
                    'Biology': 'bg-green-100 text-green-800',
                    'Physics': 'bg-blue-100 text-blue-800',
                    'Chemistry': 'bg-purple-100 text-purple-800',
                    'ICT': 'bg-orange-100 text-orange-800'
                };

                var discountVal = 0;
                var regVal = 0, promoVal = 0;
                if (course.originalPrice && course.price) {
                    regVal = parseFloat(course.originalPrice.replace(/[^\d.]/g, ''));
                    promoVal = parseFloat(course.price.replace(/[^\d.]/g, ''));
                    discountVal = regVal - promoVal;
                }

                return `
                    <div class="bg-white rounded-lg shadow-sm overflow-hidden card-hover">
                        <div class="h-48 overflow-hidden relative">
                            <img src="${course.image}" 
                                 alt="${course.title}" 
                                 class="w-full h-full object-cover training-image"
                                 onclick="openImageViewer(this.src, this.alt)"
                                 onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">
                            <div class="absolute top-2 left-2">
                                <span class="${catColors[course.category]} px-2 py-1 rounded text-xs font-medium">${course.category}</span>
                            </div>
                            <div class="absolute top-2 right-2 flex space-x-1">
                                <button onclick="showAbout('${course.id}')" class="bg-white bg-opacity-90 hover:bg-opacity-100 rounded-full p-2 shadow-sm transition-all">
                                    <svg class="w-5 h-5 text-gray-700" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                                    </svg>
                                </button>
                                <button onclick="playAudio('${course.id}')" class="bg-white bg-opacity-90 hover:bg-opacity-100 rounded-full p-2 shadow-sm transition-all">
                                    <svg class="w-5 h-5 text-gray-700" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.617.797l-4.146-3.317a1 1 0 00-.632-.22H2a1 1 0 01-1-1V7.64a1 1 0 011-1h1.605a1 1 0 00.632-.22l4.146-3.317a1 1 0 011.617.797zM14.657 7.757a1 1 0 011.414 0A9.972 9.972 0 0118 12a9.972 9.972 0 01-1.929 4.243 1 1 0 11-1.414-1.414A7.971 7.971 0 0016 12c0-1.594-.463-3.078-1.343-4.243a1 1 0 010-1.414z" clip-rule="evenodd"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="p-4">
                            <h3 class="font-semibold text-papsi-dark mb-2">${course.title}</h3>
                            <p class="text-gray-600 text-sm mb-3">${course.instructor}</p>
                            <div class="flex justify-between items-center mb-3">
                                <div class="flex items-center space-x-2">
                                    <span class="text-papsi-gold font-semibold">${course.price}</span>
                                    ${course.originalPrice ? `<span class="text-gray-400 line-through text-sm">${course.originalPrice}</span>` : ''}
                                    ${(discountVal > 0) ? `<span class="bg-red-100 text-red-800 px-2 py-1 rounded text-xs font-medium">â‚±${discountVal} OFF</span>` : ''}
                                </div>
                                <span class="text-xs text-gray-500">${course.duration}</span>
                            </div>
                            <button class="w-full py-2 rounded transition-colors ${isInCart(course.id) ? 'bg-gray-400 cursor-not-allowed' : 'bg-papsi-green hover:bg-green-700 text-white'}" onclick="addToCart('${course.id}'); event.stopPropagation();" ${isInCart(course.id) ? 'disabled' : ''}>
                                ${isInCart(course.id) ? 'Added to Cart' : 'Register Now'}
                            </button>
                        </div>
                    </div>
                `;
                const categoryColors = {
                    'Biology': 'bg-green-100 text-green-800',
                    'Physics': 'bg-blue-100 text-blue-800',
                    'Chemistry': 'bg-purple-100 text-purple-800',
                    'ICT': 'bg-orange-100 text-orange-800'
                };

                // Calculate discount dynamically
                let discount = 0;
                let regular = 0, promo = 0;
                if (course.originalPrice && course.price) {
                    // Remove non-numeric chars (like â‚±)
                    regular = parseFloat(course.originalPrice.replace(/[^\d.]/g, ''));
                    promo = parseFloat(course.price.replace(/[^\d.]/g, ''));
                    discount = regular - promo;
                }

                return `
                    <div class="bg-white rounded-lg shadow-sm overflow-hidden card-hover">
                        <div class="h-48 overflow-hidden relative">
                            <img src="${course.image}" 
                                 alt="${course.title}" 
                                 class="w-full h-full object-cover training-image"
                                 onclick="openImageViewer(this.src, this.alt)"
                                 onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">
                            <div class="absolute top-2 left-2">
                                <span class="${categoryColors[course.category]} px-2 py-1 rounded text-xs font-medium">${course.category}</span>
                            </div>
                            <div class="absolute top-2 right-2 flex space-x-1">
                                <button onclick="showAbout('${course.id}')" class="bg-white bg-opacity-90 hover:bg-opacity-100 rounded-full p-2 shadow-sm transition-all">
                                    <svg class="w-5 h-5 text-gray-700" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                                    </svg>
                                </button>
                                <button onclick="playAudio('${course.id}')" class="bg-white bg-opacity-90 hover:bg-opacity-100 rounded-full p-2 shadow-sm transition-all">
                                    <svg class="w-5 h-5 text-gray-700" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.617.797l-4.146-3.317a1 1 0 00-.632-.22H2a1 1 0 01-1-1V7.64a1 1 0 011-1h1.605a1 1 0 00.632-.22l4.146-3.317a1 1 0 011.617.797zM14.657 7.757a1 1 0 011.414 0A9.972 9.972 0 0118 12a9.972 9.972 0 01-1.929 4.243 1 1 0 11-1.414-1.414A7.971 7.971 0 0016 12c0-1.594-.463-3.078-1.343-4.243a1 1 0 010-1.414z" clip-rule="evenodd"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="p-4">
                            <h3 class="font-semibold text-papsi-dark mb-2">${course.title}</h3>
                            <p class="text-gray-600 text-sm mb-3">${course.instructor}</p>
                            <div class="flex justify-between items-center mb-3">
                                <div class="flex items-center space-x-2">
                                    <span class="text-papsi-gold font-semibold">${course.price}</span>
                                    ${course.originalPrice ? `<span class="text-gray-400 line-through text-sm">${course.originalPrice}</span>` : ''}
                                    ${(discount > 0) ? `<span class="bg-red-100 text-red-800 px-2 py-1 rounded text-xs font-medium">â‚±${discount} OFF</span>` : ''}
                                </div>
                                <span class="text-xs text-gray-500">${course.duration}</span>
                            </div>
                            <button class="w-full bg-papsi-green text-white py-2 rounded hover:bg-green-700 transition-colors">
                                Register Now
                            </button>
                        </div>
                    </div>
                `;
            }).join('');

            // Pagination controls (dynamically render below courses)
            if (totalPages > 1) {
                const paginationHTML = `
                    <div class="w-full flex justify-center mt-6">
                        <div class="flex items-center space-x-4">
                            <button onclick="changeCoursesPage(-1)" class="px-4 py-2 rounded border ${currentPage === 1 ? 'bg-gray-200 text-gray-400 cursor-not-allowed' : 'bg-white text-gray-700 hover:bg-gray-100'}" ${currentPage === 1 ? 'disabled' : ''}>Previous</button>
                            <span class="mx-2 text-sm">Page ${currentPage} of ${totalPages}</span>
                            <button onclick="changeCoursesPage(1)" class="px-4 py-2 rounded border ${currentPage === totalPages ? 'bg-gray-200 text-gray-400 cursor-not-allowed' : 'bg-white text-gray-700 hover:bg-gray-100'}" ${currentPage === totalPages ? 'disabled' : ''}>Next</button>
                        </div>
                    </div>
                `;
                grid.innerHTML += paginationHTML;
            }
        }

        function changeCoursesPage(delta) {
            const totalPages = Math.ceil(filteredCourses.length / coursesPerPage);
            currentPage += delta;
            if (currentPage < 1) currentPage = 1;
            if (currentPage > totalPages) currentPage = totalPages;
            renderCourses();
            updateCartCount();
        }

        function updateCounters() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            const speakerFilter = document.getElementById('speakerFilter').value;
            
            // Calculate total available courses for current filters (including search)
            let totalAvailable = allCourses.filter(course => {
                const matchesSearch = !searchTerm || 
                    course.title.toLowerCase().includes(searchTerm) ||
                    course.instructor.toLowerCase().includes(searchTerm) ||
                    course.description.toLowerCase().includes(searchTerm);
                
                const matchesCategory = categoryFilter === 'all' || course.category === categoryFilter;
                const matchesSpeaker = speakerFilter === 'all' || course.instructor === speakerFilter;

                return matchesSearch && matchesCategory && matchesSpeaker;
            }).length;
            
            const shownCourses = filteredCourses.length;
            
            // Update results counter
            document.getElementById('resultsCounter').textContent = `Showing ${shownCourses} of ${totalAvailable} courses`;
            updateCartCount();

        }

        // Cart logic
        function addToCart(courseId) {
            if (!cartCourses.includes(courseId)) {
                cartCourses.push(courseId);
                renderCourses();
                updateCartCount();
            }
        }

        function updateCartCount() {
            const cartCount = document.getElementById('cartCount');
            cartCount.textContent = cartCourses.length;
        }

        function openCart() {
            // Hide other modals
            closeAbout();
            closeAudio();
            // Render cart list
            const cartList = document.getElementById('cartList');
            let subtotal = 0;
            let total = 0;
            let voucherDiscount = 0;
            if (cartCourses.length === 0) {
                cartList.innerHTML = '<div class="text-gray-500 text-center">Your cart is empty.</div>';
                setTimeout(() => {
                    const confirmBtn = document.getElementById('confirmRegistrationBtn');
                    if (confirmBtn) {
                        confirmBtn.disabled = true;
                        confirmBtn.classList.add('bg-gray-300', 'cursor-not-allowed');
                        confirmBtn.classList.remove('bg-papsi-green', 'hover:bg-green-700');
                    }
                }, 0);
            } else {
                cartList.innerHTML = cartCourses.map(id => {
                    const course = allCourses.find(c => c.id === id);
                    if (!course) return '';
                    // Parse prices
                    let reg = 0, promo = 0;
                    if (course.originalPrice && course.price) {
                        reg = parseFloat(course.originalPrice.replace(/[^\d.]/g, ''));
                        promo = parseFloat(course.price.replace(/[^\d.]/g, ''));
                    } else if (course.price) {
                        promo = parseFloat(course.price.replace(/[^\d.]/g, ''));
                    }
                    subtotal += promo;
                    return `<div class="flex flex-col md:flex-row md:justify-between md:items-center border-b pb-2 gap-1 group">
                        <span class="font-medium">${course.title}</span>
                        <span class="flex items-center gap-2">
                            ${reg > 0 ? `<span class='text-gray-400 line-through text-sm'>â‚±${reg.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})}</span>` : ''}
                            <span class="font-semibold text-papsi-gold">â‚±${promo.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})}</span>
                            <button onclick="removeFromCart('${course.id}')" class="ml-2 text-gray-400 hover:text-red-600 transition-colors" title="Remove">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
                            </button>
                        </span>
                    </div>`;
                }).join('');
                setTimeout(() => {
                    const confirmBtn = document.getElementById('confirmRegistrationBtn');
                    if (confirmBtn) {
                        confirmBtn.disabled = false;
                        confirmBtn.classList.remove('bg-gray-300', 'cursor-not-allowed');
                        confirmBtn.classList.add('bg-papsi-green', 'hover:bg-green-700');
                    }
                }, 0);
            }
            // Voucher logic (simple: 10% off for code 'PAPSI10')
            const voucherInput = document.getElementById('voucherInput');
            let voucher = voucherInput ? voucherInput.value.trim().toUpperCase() : '';
            if (voucher === 'PAPSI10') {
                voucherDiscount = subtotal * 0.10;
            }
            total = subtotal - voucherDiscount;
            // Update subtotal and total
            document.getElementById('cartSubtotal').textContent = `â‚±${subtotal.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})}`;
            document.getElementById('cartTotal').textContent = `â‚±${total.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})}`;
            // Listen for voucher input changes
            setTimeout(() => {
                const voucherInput = document.getElementById('voucherInput');
                if (voucherInput) {
                    voucherInput.oninput = openCart;
                }
            }, 0);
            document.getElementById('cartModal').classList.remove('hidden');
        }
        function removeFromCart(courseId) {
            const idx = cartCourses.indexOf(courseId);
            if (idx !== -1) {
                cartCourses.splice(idx, 1);
                openCart();
                updateCartCount();
                renderCourses(); // Re-render course grid to update button state
            }
        }
        function confirmRegistration() {
            alert('Registration confirmed! (Implement actual registration logic here)');
            closeCart();
        }

        function closeCart() {
            document.getElementById('cartModal').classList.add('hidden');
        }

        // Search and filter functionality for My Learning page
        function filterLearningCourses() {
            const searchTerm = document.getElementById('learningSearchInput').value.toLowerCase();
            const categoryFilter = document.getElementById('learningCategoryFilter').value;
            const speakerFilter = document.getElementById('learningSpeakerFilter').value;
            const dateSort = document.getElementById('learningDateSort').value;

            // Filter courses
            filteredLearningCourses = allCourses.filter(course => {
                const matchesSearch = !searchTerm || 
                    course.title.toLowerCase().includes(searchTerm) ||
                    course.instructor.toLowerCase().includes(searchTerm) ||
                    course.description.toLowerCase().includes(searchTerm);
                
                const matchesCategory = categoryFilter === 'all' || course.category === categoryFilter;
                const matchesSpeaker = speakerFilter === 'all' || course.instructor === speakerFilter;

                return matchesSearch && matchesCategory && matchesSpeaker;
            });

            // Sort courses
            filteredLearningCourses.sort((a, b) => {
                if (dateSort === 'newest') {
                    return b.date - a.date;
                } else {
                    return a.date - b.date;
                }
            });

            renderLearningCourses();
            updateLearningCounters();
        }

        function renderLearningCourses() {
            const grid = document.getElementById('learningCoursesGrid');
            
            if (filteredLearningCourses.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6-4h6m2 5.291A7.962 7.962 0 0112 15c-2.34 0-4.29-1.009-5.824-2.562M15 6.306a7.962 7.962 0 00-6 0m6 0V5a2 2 0 00-2-2H9a2 2 0 00-2 2v1.306m8 0V7a2 2 0 012 2v6.414l.293.293a1 1 0 001.414-1.414L16 12.586V11a2 2 0 00-2-2H8a2 2 0 00-2 2v1.586l-2.707 2.707a1 1 0 001.414 1.414L7 14.414V13a2 2 0 012-2h6a2 2 0 012 2z"/>
                        </svg>
                        <h3 class="mt-2 text-sm font-medium text-gray-900">No courses found</h3>
                        <p class="mt-1 text-sm text-gray-500">Try adjusting your search or filter criteria.</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = filteredLearningCourses.map(course => {
                const categoryColors = {
                    'Biology': 'bg-green-100 text-green-800',
                    'Physics': 'bg-blue-100 text-blue-800',
                    'Chemistry': 'bg-purple-100 text-purple-800',
                    'ICT': 'bg-orange-100 text-orange-800'
                };

                return `
                    <div class="bg-white rounded-lg shadow-sm overflow-hidden card-hover">
                        <div class="h-48 overflow-hidden relative">
                            <img src="${course.image}" 
                                 alt="${course.title}" 
                                 class="w-full h-full object-cover training-image"
                                 onclick="openImageViewer(this.src, this.alt)"
                                 onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">
                            <div class="absolute top-2 left-2">
                                <span class="${categoryColors[course.category]} px-2 py-1 rounded text-xs font-medium">${course.category}</span>
                            </div>
                        </div>
                        <div class="p-4">
                            <h3 class="font-semibold text-papsi-dark mb-2">${course.title}</h3>
                            <p class="text-gray-600 text-sm mb-3">${course.instructor}</p>
                            <div class="flex justify-between items-center mb-3">
                                <span class="text-xs text-gray-500">${course.duration}</span>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="openCourseContent('video', '${course.title}')" class="flex-1 bg-blue-600 text-white py-2 px-3 rounded text-sm hover:bg-blue-700 transition-colors flex items-center justify-center space-x-1">
                                    <span>ðŸ“¹</span>
                                    <span>Video</span>
                                </button>
                                <button onclick="openCourseContent('module', '${course.title}')" class="flex-1 bg-orange-600 text-white py-2 px-3 rounded text-sm hover:bg-orange-700 transition-colors flex items-center justify-center space-x-1">
                                    <span>ðŸ“š</span>
                                    <span>Module</span>
                                </button>
                                <button onclick="openCourseContent('presentation', '${course.title}')" class="flex-1 bg-purple-600 text-white py-2 px-3 rounded text-sm hover:bg-purple-700 transition-colors flex items-center justify-center space-x-1">
                                    <span>ðŸ“Š</span>
                                    <span>Slides</span>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateLearningCounters() {
            const searchTerm = document.getElementById('learningSearchInput').value.toLowerCase();
            const categoryFilter = document.getElementById('learningCategoryFilter').value;
            const speakerFilter = document.getElementById('learningSpeakerFilter').value;
            
            // Calculate total available courses for current filters (including search)
            let totalAvailable = allCourses.filter(course => {
                const matchesSearch = !searchTerm || 
                    course.title.toLowerCase().includes(searchTerm) ||
                    course.instructor.toLowerCase().includes(searchTerm) ||
                    course.description.toLowerCase().includes(searchTerm);
                
                const matchesCategory = categoryFilter === 'all' || course.category === categoryFilter;
                const matchesSpeaker = speakerFilter === 'all' || course.instructor === speakerFilter;

                return matchesSearch && matchesCategory && matchesSpeaker;
            }).length;
            
            const shownCourses = filteredLearningCourses.length;
            
            // Update results counter
            document.getElementById('learningResultsCounter').textContent = `Showing ${shownCourses} of ${totalAvailable} courses`;
        }

        function clearLearningSearch() {
            document.getElementById('learningSearchInput').value = '';
            document.getElementById('clearLearningSearch').classList.add('hidden');
            filterLearningCourses();
        }

        function clearSearch() {
            document.getElementById('searchInput').value = '';
            document.getElementById('clearSearch').classList.add('hidden');
            filterCourses();
        }

        // Event listeners for search and filters
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const clearBtn = document.getElementById('clearSearch');
            if (e.target.value) {
                clearBtn.classList.remove('hidden');
            } else {
                clearBtn.classList.add('hidden');
            }
            filterCourses();
        });

        document.getElementById('categoryFilter').addEventListener('change', filterCourses);
        document.getElementById('speakerFilter').addEventListener('change', filterCourses);
        document.getElementById('dateSort').addEventListener('change', filterCourses);
        document.getElementById('clearSearch').addEventListener('click', clearSearch);

        // Event listeners for My Learning page search and filters
        document.getElementById('learningSearchInput').addEventListener('input', function(e) {
            const clearBtn = document.getElementById('clearLearningSearch');
            if (e.target.value) {
                clearBtn.classList.remove('hidden');
            } else {
                clearBtn.classList.add('hidden');
            }
            filterLearningCourses();
        });

        document.getElementById('learningCategoryFilter').addEventListener('change', filterLearningCourses);
        document.getElementById('learningSpeakerFilter').addEventListener('change', filterLearningCourses);
        document.getElementById('learningDateSort').addEventListener('change', filterLearningCourses);
        document.getElementById('clearLearningSearch').addEventListener('click', clearLearningSearch);

        function showPage(page) {
            // Hide all pages
            document.querySelectorAll('.page-content').forEach(p => p.classList.add('hidden'));
            
            // Remove active class from all buttons
            document.querySelectorAll('nav button').forEach(btn => {
                btn.classList.remove('active-tab');
                btn.classList.add('text-gray-500');
            });
            
            // Show selected page
            document.getElementById(page + '-page').classList.remove('hidden');
            
            // Add active class to selected button
            const activeBtn = document.getElementById(page + '-btn');
            activeBtn.classList.add('active-tab');
            activeBtn.classList.remove('text-gray-500');

            // Initialize courses grid if hub page is shown
            if (page === 'hub') {
                renderCourses();
                updateCounters();
            }

            // Initialize learning courses grid if learning page is shown
            if (page === 'learning') {
                renderLearningCourses();
                updateLearningCounters();
            }
        }

        function openImageViewer(src, alt) {
            const viewer = document.getElementById('imageViewer');
            const image = document.getElementById('viewerImage');
            
            image.src = src;
            image.alt = alt;
            viewer.classList.remove('hidden');
            
            // Reset zoom and position
            currentZoom = 1;
            translateX = 0;
            translateY = 0;
            updateImageTransform();
            
            // Prevent body scroll when viewer is open
            document.body.style.overflow = 'hidden';
        }

        function closeImageViewer() {
            const viewer = document.getElementById('imageViewer');
            viewer.classList.add('hidden');
            
            // Restore body scroll
            document.body.style.overflow = 'auto';
        }

    let aboutCourseId = null;
    function showAbout(courseId) {
            aboutCourseId = courseId;
            const modal = document.getElementById('aboutModal');
            const title = document.getElementById('aboutTitle');
            const content = document.getElementById('aboutContent');
            // Find course by id in allCourses or filteredCourses
            const course = allCourses.find(c => c.id === courseId) || filteredCourses.find(c => c.id === courseId);
            if (!course) return;
            title.textContent = course.title;
            content.innerHTML = `
                <div class="space-y-4">
                    <div>
                        <h4 class="font-semibold text-papsi-dark mb-2">Speaker</h4>
                        <p class="text-gray-600">${course.instructor || course.speaker || ''}</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <h4 class="font-semibold text-papsi-dark mb-2">Duration</h4>
                            <p class="text-gray-600">${course.duration || (course.hours ? course.hours + ' hours' : '')}</p>
                        </div>
                        <div>
                            <h4 class="font-semibold text-papsi-dark mb-2">Price</h4>
                            <div class="flex items-center space-x-2">
                                <p class="text-papsi-gold font-bold text-lg">${course.price || ''}</p>
                                ${course.originalPrice ? `<span class=\"text-gray-400 line-through text-sm\">${course.originalPrice}</span>` : ''}
                                ${(course.originalPrice && course.originalPrice !== course.price) ? `<span class=\"bg-red-100 text-red-800 px-2 py-1 rounded text-xs font-medium\">Discount</span>` : ''}
                            </div>
                        </div>
                    </div>
                    <div>
                        <h4 class="font-semibold text-papsi-dark mb-2">About</h4>
                        <p class="text-gray-600">${course.description || course.about || ''}</p>
                    </div>
                </div>
            `;
            // Update Register Now button state
            setTimeout(() => {
                const btn = document.getElementById('aboutRegisterBtn');
                if (btn) {
                    if (isInCart(courseId)) {
                        btn.textContent = 'Added to Cart';
                        btn.classList.add('bg-gray-400', 'cursor-not-allowed');
                        btn.classList.remove('bg-papsi-green', 'hover:bg-green-700');
                        btn.disabled = true;
                    } else {
                        btn.textContent = 'Register Now';
                        btn.classList.remove('bg-gray-400', 'cursor-not-allowed');
                        btn.classList.add('bg-papsi-green', 'hover:bg-green-700');
                        btn.disabled = false;
                    }
                }
            }, 0);
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeAbout() {
            const modal = document.getElementById('aboutModal');
            modal.classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

    let audioCourseId = null;
    function playAudio(courseId) {
            audioCourseId = courseId;
            const modal = document.getElementById('audioModal');
            const title = document.getElementById('audioTitle');
            const description = document.getElementById('audioDescription');
            // Find course by id in allCourses or filteredCourses
            const course = allCourses.find(c => c.id === courseId) || filteredCourses.find(c => c.id === courseId);
            if (!course) return;
            title.textContent = `${course.title} - Audio Preview`;
            // Add a working audio player if course.audio is a valid URL
            let audioPlayerHtml = '';
            if (course.audio && typeof course.audio === 'string' && course.audio.startsWith('http')) {
                audioPlayerHtml = `<audio id="courseAudioPlayer" controls style="width:100%;margin-top:1rem;">
                    <source src="${course.audio}" type="audio/mpeg">
                    Your browser does not support the audio element.
                </audio>`;
            } else {
                audioPlayerHtml = `<div class='text-red-500 mt-2'>No audio preview available.</div>`;
            }
            description.innerHTML = `Listen to a preview.${audioPlayerHtml}`;
            // Update Register Now button state
            setTimeout(() => {
                const btn = document.getElementById('audioRegisterBtn');
                if (btn) {
                    if (isInCart(courseId)) {
                        btn.textContent = 'Added to Cart';
                        btn.classList.add('bg-gray-400', 'cursor-not-allowed');
                        btn.classList.remove('bg-papsi-green', 'hover:bg-green-700');
                        btn.disabled = true;
                    } else {
                        btn.textContent = 'Register Now';
                        btn.classList.remove('bg-gray-400', 'cursor-not-allowed');
                        btn.classList.add('bg-papsi-green', 'hover:bg-green-700');
                        btn.disabled = false;
                    }
                }
            }, 0);
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            // Reset audio state (legacy UI, not used with native player)
            audioPlaying = false;
            audioProgress = 0;
            updateAudioUI();
        }

// Move these out of the modal functions so they are global
function aboutRegisterNow() {
    if (aboutCourseId && !isInCart(aboutCourseId)) {
        addToCart(aboutCourseId);
        showAbout(aboutCourseId);
    }
}

function audioRegisterNow() {
    if (audioCourseId && !isInCart(audioCourseId)) {
        addToCart(audioCourseId);
        playAudio(audioCourseId);
    }
}

        function closeAudio() {
            const modal = document.getElementById('audioModal');
            modal.classList.add('hidden');
            document.body.style.overflow = 'auto';
            
            // Stop audio if playing
            if (audioPlaying) {
                toggleAudio();
            }
        }

        function toggleAudio() {
            audioPlaying = !audioPlaying;
            
            if (audioPlaying) {
                // Start audio simulation
                audioInterval = setInterval(() => {
                    audioProgress += 1;
                    if (audioProgress >= 150) { // 2:30 duration
                        audioProgress = 150;
                        audioPlaying = false;
                        clearInterval(audioInterval);
                    }
                    updateAudioUI();
                }, 1000);
            } else {
                // Pause audio
                clearInterval(audioInterval);
            }
            
            updateAudioUI();
        }

        function updateAudioUI() {
            const playIcon = document.getElementById('playIcon');
            const pauseIcon = document.getElementById('pauseIcon');
            const currentTime = document.getElementById('currentTime');
            const progressBar = document.getElementById('progressBar');
            
            if (audioPlaying) {
                playIcon.classList.add('hidden');
                pauseIcon.classList.remove('hidden');
            } else {
                playIcon.classList.remove('hidden');
                pauseIcon.classList.add('hidden');
            }
            
            // Update time display
            const minutes = Math.floor(audioProgress / 60);
            const seconds = audioProgress % 60;
            currentTime.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            // Update progress bar
            const progressPercent = (audioProgress / 150) * 100;
            progressBar.style.width = `${progressPercent}%`;
        }

        function seekAudio(event) {
            const progressContainer = event.currentTarget;
            const rect = progressContainer.getBoundingClientRect();
            const clickX = event.clientX - rect.left;
            const progressPercent = (clickX / rect.width) * 100;
            
            audioProgress = Math.floor((progressPercent / 100) * 150);
            updateAudioUI();
        }

        function setVolume(value) {
            // Volume control simulation
            console.log('Volume set to:', value);
        }

        function zoomIn() {
            currentZoom = Math.min(currentZoom * 1.2, 5);
            updateImageTransform();
        }

        function zoomOut() {
            currentZoom = Math.max(currentZoom / 1.2, 0.5);
            updateImageTransform();
        }

        function resetZoom() {
            currentZoom = 1;
            translateX = 0;
            translateY = 0;
            updateImageTransform();
        }

        function updateImageTransform() {
            const image = document.getElementById('viewerImage');
            image.style.transform = `scale(${currentZoom}) translate(${translateX}px, ${translateY}px)`;
        }

        // Mouse drag functionality
        document.getElementById('imageContainer').addEventListener('mousedown', function(e) {
            if (currentZoom > 1) {
                isDragging = true;
                startX = e.clientX - translateX;
                startY = e.clientY - translateY;
                e.preventDefault();
            }
        });

        document.addEventListener('mousemove', function(e) {
            if (isDragging && currentZoom > 1) {
                translateX = e.clientX - startX;
                translateY = e.clientY - startY;
                updateImageTransform();
            }
        });

        document.addEventListener('mouseup', function() {
            isDragging = false;
        });

        // Touch drag functionality for mobile
        document.getElementById('imageContainer').addEventListener('touchstart', function(e) {
            if (currentZoom > 1 && e.touches.length === 1) {
                isDragging = true;
                startX = e.touches[0].clientX - translateX;
                startY = e.touches[0].clientY - translateY;
                e.preventDefault();
            }
        });

        document.addEventListener('touchmove', function(e) {
            if (isDragging && currentZoom > 1 && e.touches.length === 1) {
                translateX = e.touches[0].clientX - startX;
                translateY = e.touches[0].clientY - startY;
                updateImageTransform();
                e.preventDefault();
            }
        });

        document.addEventListener('touchend', function() {
            isDragging = false;
        });

        // Mouse wheel zoom
        document.getElementById('imageContainer').addEventListener('wheel', function(e) {
            e.preventDefault();
            if (e.deltaY < 0) {
                zoomIn();
            } else {
                zoomOut();
            }
        });

        // Close modals when clicking outside
        document.getElementById('imageViewer').addEventListener('click', function(e) {
            if (e.target === this) {
                closeImageViewer();
            }
        });

        document.getElementById('aboutModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeAbout();
            }
        });

        document.getElementById('audioModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeAudio();
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            const imageViewer = document.getElementById('imageViewer');
            const aboutModal = document.getElementById('aboutModal');
            const audioModal = document.getElementById('audioModal');
            
            if (!imageViewer.classList.contains('hidden')) {
                switch(e.key) {
                    case 'Escape':
                        closeImageViewer();
                        break;
                    case '+':
                    case '=':
                        zoomIn();
                        break;
                    case '-':
                        zoomOut();
                        break;
                    case '0':
                        resetZoom();
                        break;
                }
            } else if (!aboutModal.classList.contains('hidden')) {
                if (e.key === 'Escape') {
                    closeAbout();
                }
            } else if (!audioModal.classList.contains('hidden')) {
                if (e.key === 'Escape') {
                    closeAudio();
                } else if (e.key === ' ') {
                    e.preventDefault();
                    toggleAudio();
                }
            }
        });

        // Handle form submission
        document.querySelector('form').addEventListener('submit', function(e) {
            e.preventDefault();
            alert('Profile updated successfully!');
        });

        // Handle course content access
        function openCourseContent(contentType, courseName) {
            const contentTypeNames = {
                'video': 'Video Lecture',
                'module': 'Course Module',
                'presentation': 'Presentation Materials'
            };
            
            alert(`Opening ${contentTypeNames[contentType]} for "${courseName}". This would normally open the ${contentType} content in a new window or embedded player.`);
        }

        // Handle enrollment buttons
        document.addEventListener('click', function(e) {
            if (e.target.textContent === 'Register Now') {
                alert('Registration process initiated! You will be redirected to payment.');
            }
        });

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('cartButton').addEventListener('click', openCart);
            const cartModal = document.getElementById('cartModal');
            if (!cartModal.classList.contains('hidden')) {
                if (e.key === 'Escape') {
                    closeCart();
                }
            }
            loadAnnouncements();
            loadAnnouncements();
            loadTrainingCourses();
            renderLearningCourses();
            updateLearningCounters();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98288178e4bb6e8c',t:'MTc1ODQ0NjYyNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
